<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Your Museum Scavenger Hunt</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* optional highlight state so user sees what they clicked */
    .topic-btn.selected {
      background: #111;
      color: #fff;
      border-color: #000;
    }
  </style>
</head>
<body>

<header>
  <h1>Create Your Own Museum Scavenger Hunt!</h1>
  <p>
    Find artworks that match your interests with an AI-generated scavenger hunt map.
    Currently available for The Metropolitan Museum of Art (The Met). More museums coming soon.
  </p>
</header>

<main>

  <!-- Section: Museum Selection -->
  <section>
    <label class="label" for="museum">Select your museum</label>
    <select id="museum" disabled>
      <option>The Met (New York City)</option>
      <option>MoMA (coming soon)</option>
      <option>Louvre (coming soon)</option>
      <option>British Museum (coming soon)</option>
    </select>
    <div class="hint">
      You are at: The Met
    </div>
  </section>

  <!-- Section: Topic Selection -->
  <section>
    <div class="label">Choose a topic of interest</div>

    <div class="topics-grid" id="topics-grid">
      <button class="topic-btn" type="button" onclick="selectTopic('Space')">Space</button>
      <button class="topic-btn" type="button" onclick="selectTopic('Transportation Vehicles')">Transportation Vehicles</button>
      <button class="topic-btn" type="button" onclick="selectTopic('Fashion')">Fashion</button>
      <button class="topic-btn" type="button" onclick="selectTopic('Ancient Egypt')">Ancient Egypt</button>
      <button class="topic-btn" type="button" onclick="selectTopic('Warriors & Battles')">Warriors &amp; Battles</button>
      <button class="topic-btn" type="button" onclick="selectTopic('Music & Instruments')">Music &amp; Instruments</button>
      <button class="topic-btn" type="button" onclick="selectTopic('Flowers & Plants')">Flowers &amp; Plants</button>
      <button class="topic-btn" type="button" onclick="selectTopic('Kings & Queens')">Kings &amp; Queens</button>
    </div>

    <div class="label" style="margin-top:16px;">Or enter your own topic</div>
    <input
      type="text"
      id="custom-topic"
      placeholder="Example: dragons, cats, space, myths"
    />
    <div class="hint">
      If you type here, that will override the button you clicked.
    </div>
  </section>

  <!-- Section: Generate -->
  <section>

<button class="generate-btn" id="generate-btn" type="button">
  <!-- visible by default -->
  <span class="generate-inner" id="btn-content">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M21 10c0 6-9 12-9 12s-9-6-9-12a9 9 0 1 1 18 0z"></path>
      <circle cx="12" cy="10" r="3"></circle>
    </svg>
    <span>Generate Map</span>
  </span>

  <!-- hidden until click -->
  <span class="generate-inner" id="btn-loading" style="display:none;">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="loading-spinner"
    >
      <circle
        cx="12"
        cy="12"
        r="9"
        stroke="currentColor"
        stroke-opacity="0.25"
      />
      <path
        d="M21 12a9 9 0 0 0-9-9"
        stroke="currentColor"
        stroke-linecap="round"
        stroke-opacity="1"
      />
    </svg>
    <span>Generatingâ€¦</span>
  </span>
</button>

  </section>

</main>

<footer>
  Prototype interface. Text and layout subject to change.
</footer>

<script>
    // SEND TO n8n
    const WEBHOOK_URL = "https://xinhuix-n8n-free.hf.space/webhook/83e18bf2-4e57-48e4-bd1f-a27b529435be";


  let selectedPresetTopic = null;

  function selectTopic(topicText) {
    selectedPresetTopic = topicText;

    const allButtons = document.querySelectorAll('.topic-btn');
    allButtons.forEach(btn => btn.classList.remove('selected'));

    const match = Array.from(allButtons).find(
      btn => btn.textContent.trim() === topicText
    );
    if (match) match.classList.add('selected');

    document.getElementById('custom-topic').value = '';
  }

  async function submitTopic() {
    const generateBtn = document.getElementById('generate-btn');
    const btnContent = document.getElementById('btn-content');
    const btnLoading = document.getElementById('btn-loading');

    const customTopic = document.getElementById('custom-topic').value.trim();
    const museum = "The Met";
    const finalTopic = customTopic || selectedPresetTopic;

    // 1. VALIDATION FIRST
    if (!finalTopic) {
      alert("Please pick a topic or type your own.");
      return;
    }

    // 2. NOW enter loading state (only if we passed validation)
    generateBtn.classList.add('is-loading');
    btnContent.style.display = 'none';
    btnLoading.style.display = 'inline-flex';

    try {
      const response = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          museum: museum,
          topic: finalTopic
        })
      });

      let data;
      try {
        data = await response.json();
      } catch {
        const text = await response.text();
        data = { output: text };
      }

  // Persist response for map page to consume
  localStorage.setItem("huntTopic", finalTopic);
  localStorage.setItem("huntOutput", data.output || "");

  // Navigate directly to the map page (skip debug panel)
  window.location.href = 'map.html';
    } catch (err) {
      console.error("Fetch error:", err);
      alert("There was an error generating your map. Please try again.");

      // restore button so they can retry
      generateBtn.classList.remove('is-loading');
      btnContent.style.display = 'inline-flex';
      btnLoading.style.display = 'none';
    }
  }

  document
    .getElementById('generate-btn')
    .addEventListener('click', submitTopic);

  // Debug panel removed: navigation happens directly to map.html after webhook
</script>

</body>
</html>